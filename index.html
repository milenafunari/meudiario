<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ“˜ DiÃ¡rio de Humor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background-color: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #444;
    }
    form {
      background: #fff;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 700px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.7rem 1.5rem;
      background-color: #6d4c41;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      margin-right: 10px;
    }
    button:hover {
      background-color: #5d4037;
    }

    .historico {
      margin-top: 3rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    .registro {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    .registro strong {
      color: #555;
    }
    .registro small {
      color: #888;
    }
  </style>
</head>
<body>

  <h1>ğŸ“˜ DiÃ¡rio de Humor</h1>
  <p style="text-align:center;">Registre seu dia com leveza e reestruture pensamentos usando tÃ©cnicas da TCC.</p>

  <form id="diarioForm">
    
    <label for="data">ğŸ“… Data</label>
    <input type="date" id="data" name="data" required />

    <label for="situacao">ğŸ’­ SituaÃ§Ã£o do dia</label>
    <textarea id="situacao" name="situacao" rows="3" placeholder="Descreva brevemente o que aconteceu..."></textarea>

    <label for="pensamento">ğŸ§  Pensamento automÃ¡tico</label>
    <textarea id="pensamento" name="pensamento" rows="3" placeholder="O que veio Ã  mente automaticamente?"></textarea>

    <label for="reestruturacao">ğŸ” ReestruturaÃ§Ã£o cognitiva</label>
    <textarea id="reestruturacao" name="reestruturacao" rows="3" placeholder="Como vocÃª vÃª a situaÃ§Ã£o agora, de forma mais realista ou leve?"></textarea>

    <label for="humor">ğŸ˜„ Humor do dia</label>
    <select id="humor" name="humor">
      <option value="">Selecione...</option>
      <option value="ğŸ˜‚ Muito bom">ğŸ˜‚ Muito bom</option>
      <option value="ğŸ™‚ Bom">ğŸ™‚ Bom</option>
      <option value="ğŸ˜ Neutro">ğŸ˜ Neutro</option>
      <option value="ğŸ˜¢ Ruim">ğŸ˜¢ Ruim</option>
      <option value="ğŸ˜¡ Muito ruim">ğŸ˜¡ Muito ruim</option>
    </select>

    <label for="energia">âš¡ NÃ­vel de energia</label>
    <select id="energia" name="energia">
      <option value="">Selecione...</option>
      <option value="Baixa ğŸŒ">Baixa ğŸŒ</option>
      <option value="MÃ©dia ğŸ¦¥">MÃ©dia ğŸ¦¥</option>
      <option value="Alta ğŸ">Alta ğŸ</option>
    </select>

    <label for="sono">ğŸ˜´ Sono da noite anterior</label>
    <select id="sono" name="sono">
      <option value="">Selecione...</option>
      <option value="Pouco ğŸ’¤">Pouco ğŸ’¤</option>
      <option value="Normal ğŸ˜´">Normal ğŸ˜´</option>
      <option value="Demais ğŸ›Œ">Demais ğŸ›Œ</option>
    </select>

    <label for="medicacao">ğŸ’Š Tomou medicaÃ§Ã£o?</label>
    <select id="medicacao" name="medicacao">
      <option value="">Selecione...</option>
      <option value="Tomei tudo âœ…">Tomei tudo âœ…</option>
      <option value="Esqueci alguma âŒ">Esqueci alguma âŒ</option>
      <option value="NÃ£o tomei hoje">NÃ£o tomei hoje</option>
    </select>

    <label for="gatilho">ğŸ§¨ Gatilho emocional do dia</label>
    <select id="gatilho" name="gatilho">
      <option value="">Selecione...</option>
      <option value="Estresse">Estresse</option>
      <option value="Festa/fim de semana">Festa/fim de semana</option>
      <option value="DiscussÃ£o">DiscussÃ£o</option>
      <option value="Nada especÃ­fico">Nada especÃ­fico</option>
      <option value="Outro">Outro</option>
    </select>

    <label for="observacao">ğŸ“ ObservaÃ§Ã£o final (opcional)</label>
    <textarea id="observacao" name="observacao" rows="3" placeholder="Alguma coisa que quer lembrar? Ou uma piada sua sobre o dia..."></textarea>

    <button type="submit">ğŸ’¾ Registrar meu dia</button>
    <button type="button" onclick="exportarRegistros()">ğŸ“¥ Exportar Registros (.json)</button>
    <button type="button" onclick="exportarPDF()">ğŸ“„ Exportar como PDF</button>
  </form>

  <!-- Ãrea de histÃ³rico -->
  <div class="historico" id="historico">
    <h2>ğŸ•’ HistÃ³rico de Registros</h2>
    <p><small>Os registros sÃ£o salvos localmente no seu navegador.</small></p>
  </div>

  <!-- Biblioteca jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>

  <script>
    const form = document.getElementById("diarioForm");
    const historicoDiv = document.getElementById("historico");

    // Carrega os registros salvos ao iniciar
    window.onload = function() {
      carregarHistorico();
    };

    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const registro = {
        data: document.getElementById("data").value,
        situacao: document.getElementById("situacao").value,
        pensamento: document.getElementById("pensamento").value,
        reestruturacao: document.getElementById("reestruturacao").value,
        humor: document.getElementById("humor").value,
        energia: document.getElementById("energia").value,
        sono: document.getElementById("sono").value,
        medicacao: document.getElementById("medicacao").value,
        gatilho: document.getElementById("gatilho").value,
        observacao: document.getElementById("observacao").value
      };

      salvarRegistro(registro);
      form.reset();
      carregarHistorico();
    });

    function salvarRegistro(registro) {
      let registros = JSON.parse(localStorage.getItem("diarioHumor")) || [];
      registros.unshift(registro); // Adiciona no inÃ­cio
      localStorage.setItem("diarioHumor", JSON.stringify(registros));
    }

    function carregarHistorico() {
      let registros = JSON.parse(localStorage.getItem("diarioHumor")) || [];

      historicoDiv.innerHTML = "<h2>ğŸ•’ HistÃ³rico de Registros</h2><p><small>Os registros sÃ£o salvos localmente no seu navegador.</small></p>";

      if (registros.length === 0) {
        historicoDiv.innerHTML += "<p><em>VocÃª ainda nÃ£o fez nenhum registro.</em></p>";
        return;
      }

      registros.forEach((reg, index) => {
        const div = document.createElement("div");
        div.className = "registro";
        div.innerHTML = `
          <strong>${reg.data}</strong> - ${reg.humor}<br><br>
          <strong>SituaÃ§Ã£o:</strong> ${reg.situacao || "<em>nÃ£o informado</em>"}<br><br>
          <strong>Pensamento automÃ¡tico:</strong> ${reg.pensamento || "<em>nÃ£o informado</em>"}<br><br>
          <strong>ReestruturaÃ§Ã£o:</strong> ${reg.reestruturacao || "<em>nÃ£o informado</em>"}<br><br>
          <strong>Energia:</strong> ${reg.energia || "<em>nÃ£o informado</em>"} | 
          <strong>Sono:</strong> ${reg.sono || "<em>nÃ£o informado</em>"} | 
          <strong>MedicaÃ§Ã£o:</strong> ${reg.medicacao || "<em>nÃ£o informado</em>"}<br>
          <strong>Gatilho:</strong> ${reg.gatilho || "<em>nÃ£o informado</em>"}<br><br>
          <strong>ObservaÃ§Ã£o:</strong> ${reg.observacao || "<em>nÃ£o informado</em>"}
        `;
        historicoDiv.appendChild(div);
      });
    }

    function exportarRegistros() {
      let registros = JSON.parse(localStorage.getItem("diarioHumor")) || [];

      if (registros.length === 0) {
        alert("VocÃª nÃ£o tem registros para exportar.");
        return;
      }

      const conteudo = JSON.stringify(registros, null, 2); // Formato bonito
      const blob = new Blob([conteudo], { type: 'application/json' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "diario_de_humor_exportado.json";
      link.click();
    }

    async function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const registros = JSON.parse(localStorage.getItem("diarioHumor")) || [];

      if (registros.length === 0) {
        alert("VocÃª nÃ£o tem registros para exportar.");
        return;
      }

      const doc = new jsPDF();

      // CabeÃ§alho
      doc.setFontSize(16);
      doc.setTextColor(40, 40, 40);
      doc.text("ğŸ“˜ DiÃ¡rio de Humor", 105, 20, null, null, "center");

      doc.setFontSize(10);
      doc.setTextColor(100, 100, 100);
      doc.text("Registros baseados em Terapia Cognitivo-Comportamental", 105, 27, null, null, "center");

      let y = 40;

      registros.forEach((reg, i) => {
        if (i > 0) y += 10;
        if (y > 270) {
          doc.addPage();
          y = 20;
        }

        doc.setFontSize(12);
        doc.setTextColor(60, 60, 60);
        doc.text(`ğŸ“Œ Registro de ${reg.data}`, 20, y);

        y += 7;
        doc.setFontSize(10);
        doc.setTextColor(80, 80, 80);
        doc.text(`Humor do dia: ${reg.humor}`, 25, y);

        y += 7;
        doc.text(`SituaÃ§Ã£o: ${reg.situacao || "(nÃ£o informado)"}`, 25, y);

        y += 7;
        doc.text(`Pensamento automÃ¡tico: ${reg.pensamento || "(nÃ£o informado)"}`, 25, y);

        y += 7;
        doc.text(`ReestruturaÃ§Ã£o: ${reg.reestruturacao || "(nÃ£o informado)"}`, 25, y);

        y += 7;
        doc.text(`Energia: ${reg.energia} | Sono: ${reg.sono} | MedicaÃ§Ã£o: ${reg.medicacao}`, 25, y);

        y += 7;
        doc.text(`Gatilho: ${reg.gatilho}`, 25, y);

        if (reg.observacao) {
          y += 7;
          doc.text(`ObservaÃ§Ã£o: ${reg.observacao}`, 25, y);
        }

        y += 10;
      });

      doc.save("Diario_de_Humor.pdf");
    }
  </script>

</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>📘 Diário de Humor</title>
  <style>
    /* Reset básico */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      color: #5e35b1;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    p {
      text-align: center;
      color: #666;
      font-size: 1rem;
      margin-bottom: 2rem;
    }

    form {
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      max-width: 700px;
      margin: auto;
      border-top: 4px solid #ba68c8;
    }

    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
      color: #555;
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 0.6rem 1rem;
      margin-top: 0.3rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #7e57c2;
      box-shadow: 0 0 0 3px rgba(126, 87, 194, 0.2);
    }

    button {
      margin-top: 1.5rem;
      padding: 0.6rem 1.2rem;
      background-color: #7e57c2;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      transition: background-color 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    button:hover {
      background-color: #673ab7;
    }

    .historico {
      margin-top: 3rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    .registro {
      background: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 1.5rem;
      border-left: 5px solid #ce93d8;
      transition: transform 0.2s ease;
    }

    .registro:hover {
      transform: translateX(3px);
    }

    .registro strong {
      color: #4a148c;
      display: inline-block;
      margin-top: 0.3rem;
      font-size: 0.95rem;
    }

    .registro small {
      color: #888;
      font-size: 0.85rem;
    }

    @media (max-width: 600px) {
      form, .registro {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>

  <h1>📘 Diário de Humor</h1>
  <p>Registre seu dia com leveza e reestruture pensamentos usando técnicas da TCC.</p>

  <!-- Botões principais -->
  <form id="diarioForm">
    
    <label for="data">📅 Data</label>
    <input type="date" id="data" name="data" required />

    <label for="situacao">💭 Situação do dia</label>
    <textarea id="situacao" name="situacao" rows="3" placeholder="Descreva brevemente o que aconteceu..."></textarea>

    <label for="pensamento">🧠 Pensamento automático</label>
    <textarea id="pensamento" name="pensamento" rows="3" placeholder="O que veio à mente automaticamente?"></textarea>

    <label for="reestruturacao">🔁 Reestruturação cognitiva</label>
    <textarea id="reestruturacao" name="reestruturacao" rows="3" placeholder="Como você vê a situação agora, de forma mais realista ou leve?"></textarea>

    <label for="humor">😄 Humor do dia</label>
    <select id="humor" name="humor">
      <option value="">Selecione...</option>
      <option value="Muito bom">😂 Muito bom</option>
      <option value="Bom">🙂 Bom</option>
      <option value="Neutro">😐 Neutro</option>
      <option value="Ruim">😢 Ruim</option>
      <option value="Muito ruim">😡 Muito ruim</option>
    </select>

    <label for="energia">⚡ Nível de energia</label>
    <select id="energia" name="energia">
      <option value="">Selecione...</option>
      <option value="Baixa">🐌 Baixa</option>
      <option value="Média">🦥 Média</option>
      <option value="Alta">🐎 Alta</option>
    </select>

    <label for="sono">😴 Sono da noite anterior</label>
    <select id="sono" name="sono">
      <option value="">Selecione...</option>
      <option value="Pouco">💤 Pouco</option>
      <option value="Normal">😴 Normal</option>
      <option value="Demais">🛌 Demais</option>
    </select>

    <label for="medicacao">💊 Tomou medicação?</label>
    <select id="medicacao" name="medicacao">
      <option value="">Selecione...</option>
      <option value="Tomei tudo">✅ Tomei tudo</option>
      <option value="Esqueci alguma">❌ Esqueci alguma</option>
      <option value="Não tomei hoje">Não tomei hoje</option>
    </select>

    <label for="gatilho">🧨 Gatilho emocional do dia</label>
    <select id="gatilho" name="gatilho">
      <option value="">Selecione...</option>
      <option value="Estresse">Estresse</option>
      <option value="Festa/fim de semana">Festa/fim de semana</option>
      <option value="Discussão">Discussão</option>
      <option value="Nada específico">Nada específico</option>
      <option value="Outro">Outro</option>
    </select>

    <label for="observacao">📝 Observação final (opcional)</label>
    <textarea id="observacao" name="observacao" rows="3" placeholder="Alguma coisa que quer lembrar? Ou uma piada sua sobre o dia..."></textarea>

    <button type="submit">💾 Registrar meu dia</button>
    <button type="button" onclick="exportarRegistros()">📥 Exportar Registros (.json)</button>
    <button type="button" onclick="exportarTelaComoPDF()">📄 Exportar Histórico como PDF</button>
    <button type="button" onclick="mostrarTutorial()">❓ Como usar</button>
  </form>

  <!-- Área de histórico -->
  <div class="historico" id="historico">
    <h2>🕒 Histórico de Registros</h2>
    <p><small>Os registros são salvos localmente no seu navegador.</small></p>
  </div>

  <!-- Bibliotecas externas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js "></script>

  <!-- Modal do Tutorial -->
  <div id="tutorialModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999; overflow:auto;">
    <div style="background:#fff; margin:5% auto; padding:2rem; border-radius:10px; max-width:600px; box-shadow:0 4px 20px rgba(0,0,0,0.1);">
      
      <h2 style="color:#5e35b1; text-align:center;">📘 Diário de Humor</h2>
      <p style="text-align:center;"><em>Um diário leve, mas poderoso</em></p>

      <p><strong>🧠 O que é?</strong><br>
      Um espaço pra registrar seu dia com técnicas da Terapia Cognitivo-Comportamental (TCC), usando o humor como ferramenta pra olhar pra si com distanciamento.</p>

      <p><strong>🎯 Pra quê serve?</strong><br>
      • Entender seus dias<br>
      • Reestruturar pensamentos automáticos<br>
      • Acompanhar seu humor ao longo do tempo<br>
      • Criar uma rotina de autoconhecimento<br>
      • Ser uma ferramenta útil pra terapeutas e acompanhamento pessoal</p>

      <p><strong>🫂 Vai ajudar em quê?</strong><br>
      Especialmente pra quem lida com Bipolaridade, o registro diário ajuda a identificar padrões, entender gatilhos e manter o controle emocional com leveza.</p>

      <p><strong>📌 Dica:</strong><br>
      Você não precisa preencher todos os campos todos os dias. Preencha quando sentir que vai te ajudar — a ideia é facilitar sua vida, não complicar 😊</p>

      <p><strong>📝 Exemplo prático:</strong></p>
      <div style="background:#f3e5f5; padding:1rem; border-left:4px solid #ba68c8; border-radius:8px; margin-bottom:1rem;">
        <p><strong>Situação:</strong> Cheguei atrasado(a) numa reunião.<br>
        <strong>Pensamento automático:</strong> “Todo mundo deve estar me julgando.”<br>
        <strong>Reestruturação:</strong> “Pode ser que nem tenham reparado. E se tiveram, provavelmente entenderam.”</p>
      </div>

      <p><strong>📊 Por que registrar o humor?</strong><br>
      Registrar o humor diário é uma forma simples de acompanhar sua saúde mental. Com isso, você pode perceber padrões, antecipar possíveis altos e baixos e compartilhar com seu terapeuta se quiser.</p>

      <p><strong>💾 Exportação:</strong><br>
      Você pode exportar seu histórico em formato `.json` (pra guardar) ou `.pdf` (pra imprimir ou mostrar pro terapeuta).</p>

      <p style="text-align:center; font-style:italic; color:#666;">Você não está sozinho(a). Cada registro é um passo pra cuidar de si com carinho.</p>

      <div style="text-align:center; margin-top:1rem;">
        <button onclick="fecharTutorial()" style="
          background:#7e57c2;
          color:white;
          border:none;
          padding:0.6rem 1.2rem;
          border-radius:8px;
          cursor:pointer;
          font-weight:bold;
        ">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Área de scripts -->
  <script>
    const form = document.getElementById("diarioForm");
    const historicoDiv = document.getElementById("historico");

    window.onload = function () {
      carregarHistorico();
    };

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const registro = {
        data: document.getElementById("data").value,
        situacao: document.getElementById("situacao").value,
        pensamento: document.getElementById("pensamento").value,
        reestruturacao: document.getElementById("reestruturacao").value,
        humor: document.getElementById("humor").value,
        energia: document.getElementById("energia").value,
        sono: document.getElementById("sono").value,
        medicacao: document.getElementById("medicacao").value,
        gatilho: document.getElementById("gatilho").value,
        observacao: document.getElementById("observacao").value
      };

      salvarRegistro(registro);
      form.reset();
      carregarHistorico();
    });

    function salvarRegistro(registro) {
      let registros = JSON.parse(localStorage.getItem("diarioHumor")) || [];
      registros.unshift(registro);
      localStorage.setItem("diarioHumor", JSON.stringify(registros));
    }

    function carregarHistorico() {
      let registros = JSON.parse(localStorage.getItem("diarioHumor")) || [];

      historicoDiv.innerHTML = "<h2>🕒 Histórico de Registros</h2><p><small>Os registros são salvos localmente no seu navegador.</small></p>";

      if (registros.length === 0) {
        historicoDiv.innerHTML += "<p><em>Você ainda não fez nenhum registro.</em></p>";
        return;
      }

      registros.forEach((reg) => {
        const div = document.createElement("div");
        div.className = "registro";
        div.innerHTML = `
          <strong>${reg.data}</strong> - ${reg.humor}<br><br>
          <strong>Situação:</strong> ${reg.situacao || "<em>não informado</em>"}<br><br>
          <strong>Pensamento automático:</strong> ${reg.pensamento || "<em>não informado</em>"}<br><br>
          <strong>Reestruturação:</strong> ${reg.reestruturacao || "<em>não informado</em>"}<br><br>
          <strong>Energia:</strong> ${reg.energia || "<em>não informado</em>"} | 
          <strong>Sono:</strong> ${reg.sono || "<em>não informado</em>"} | 
          <strong>Medicação:</strong> ${reg.medicacao || "<em>não informado</em>"}<br>
          <strong>Gatilho:</strong> ${reg.gatilho || "<em>não informado</em>"}<br><br>
          <strong>Observação:</strong> ${reg.observacao || "<em>não informado</em>"}
        `;
        historicoDiv.appendChild(div);
      });
    }

    function exportarRegistros() {
      let registros = JSON.parse(localStorage.getItem("diarioHumor")) || [];

      if (registros.length === 0) {
        alert("Você não tem registros para exportar.");
        return;
      }

      const conteudo = JSON.stringify(registros, null, 2);
      const blob = new Blob([conteudo], { type: 'application/json' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "diario_de_humor_exportado.json";
      link.click();
    }

    async function exportarTelaComoPDF() {
      const elemento = document.querySelector(".historico");

      if (!elemento || elemento.innerHTML.trim() === "") {
        alert("Não há registros para exportar.");
        return;
      }

      const canvas = await html2canvas(elemento, {
        scale: 2,
        backgroundColor: '#fff'
      });

      const imgData = canvas.toDataURL('image/png');
      const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const imgWidth = pageWidth - 20;
      const imgHeight = (canvas.height * imgWidth) / canvas.width;

      pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
      pdf.save("Historico_de_Humor.pdf");
    }

    function mostrarTutorial() {
      document.getElementById("tutorialModal").style.display = "block";
    }

    function fecharTutorial() {
      document.getElementById("tutorialModal").style.display = "none";
    }
  </script>

</body>
</html>
